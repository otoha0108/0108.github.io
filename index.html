<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üåê HELL0w0RLD! üåê</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=DotGothic16&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            background: #0f0f0f;
            color: #00fff2;
            font-family: 'DotGothic16', 'Ôº≠Ôº≥ „Ç¥„Ç∑„ÉÉ„ÇØ', 'MS Gothic', 'Osaka-Mono', monospace;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            font-size: 16px;
        }
        
        #app {
            width: 95%;
            max-width: 640px;
            border: 2px solid #14ffec;
            border-radius: 8px;
            background: #151515;
            padding: 16px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            height: 90vh;
            position: relative;
        }
        
        h1 {
            margin: 0;
            color: #14ffec;
            text-align: center;
        }
        
        #lang-toggle {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 4px;
            z-index: 1000;
        }
        
        #lang-toggle button {
            font-family: inherit;
            font-size: 12px;
            padding: 2px 6px;
            background-color: #e6007e;
            border: none;
            color: #ffffff;
            cursor: pointer;
            border-radius: 4px;
        }
        
        #lang-toggle button.active {
            background-color: #14ffec;
            color: #151515;
        }
        
        #loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
            text-align: center;
        }
        
        #loader .bar {
            width: 300px;
            height: 15px;
            border: 1px solid #00fff2;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }
        
        #loader .bar-fill {
            height: 100%;
            background: #00fff2;
            width: 0%;
            animation: loadbar 3s forwards;
        }
        
        @keyframes loadbar {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        #title {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
            text-align: center;
            opacity: 0;
            animation: fadeIn 1s forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        #usernameScreen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
            text-align: center;
        }
        
        #usernameScreen input {
            margin: 10px 0;
            padding: 8px 12px;
            background: #111;
            color: #00fff2;
            border: 1px solid #00fff2;
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
        }
        
        #usernameScreen button {
            padding: 8px 16px;
            background: #14ffec;
            color: #151515;
            border: none;
            border-radius: 4px;
            font-family: inherit;
            cursor: pointer;
        }
        
        #largeTitle {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            color: #14ffec;
            display: none;
            z-index: 500;
            text-align: center;
            text-shadow: 0 0 10px #14ffec;
            max-width: 80%;
            word-wrap: break-word;
        }
        
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            text-align: center;
            padding: 20px;
            color: #00fff2;
            box-sizing: border-box;
        }
        
        #output {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 12px;
            margin-top: 80px;
            padding-right: 4px;
        }
        
        .message {
            margin: 4px 0;
            padding: 6px 10px;
            border-radius: 8px;
            line-height: 1.4;
            max-width: 90%;
            word-wrap: break-word;
        }
        
        .log {
            background-color: #073b3a;
            color: #14ffec;
            align-self: flex-start;
        }
        
        #promptSection {
            display: none;
        }
        
        #promptText {
            margin: 0 0 8px;
        }
        
        #buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }
        
        #rankingBtn {
            grid-column: 1 / -1;
            background: #e6007e;
            color: #ffffff;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            font-family: inherit;
            margin-top: 8px;
            z-index: 100;
            position: relative;
        }
        
        #rankingBtn:hover {
            background: #ff1493;
        }
        
        #rankingBtn:active {
            background: #c71585;
        }
        
        #buttons button {
            background: #14ffec;
            color: #151515;
            border: none;
            padding: 8px;
            border-radius: 6px;
            font-size: 1em;
            cursor: pointer;
            font-family: inherit;
        }
        
        #buttons button.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        #buttons button.locked {
            opacity: 0.4;
            cursor: not-allowed;
            position: relative;
        }
        
        #buttons button.locked::after {
            content: 'üîí';
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
        }
        
        .wave-container {
            display: flex;
            gap: 4px;
            margin: 20px 0;
        }
        
        .wave-bar {
            width: 5px;
            height: 30px;
            background: #00fff2;
            animation: wave 1s infinite;
            animation-timing-function: ease-in-out;
        }
        
        @keyframes wave {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1.3); }
        }
        
        .car-container {
            width: 100%;
            height: 50px;
            position: relative;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .car {
            position: absolute;
            left: -50px;
            top: 10px;
            font-size: 28px;
            animation: drive 4s linear forwards;
        }
        
        .car.reverse {
            animation: driveReverse 4s linear forwards;
        }
        
        @keyframes drive {
            0% { left: -50px; }
            100% { left: calc(100% + 50px); }
        }
        
        @keyframes driveReverse {
            0% { left: calc(100% + 50px); }
            100% { left: -50px; }
        }
        
        .heart-scanner {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 20px auto;
            background: #001122;
            border: 2px solid #00fff2;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .heart-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 120px;
            color: #14ffec;
            z-index: 1;
        }
        
        .scan-line {
            position: absolute;
            top: -5px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #00fff2, transparent);
            box-shadow: 0 0 10px #00fff2;
            animation: heartScan 2s linear infinite;
            z-index: 2;
        }
        
        @keyframes heartScan {
            0% { top: -5px; }
            100% { top: 205px; }
        }
        
        .scan-grid {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(0, 255, 242, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 242, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .scan-bar {
            width: 300px;
            height: 15px;
            border: 1px solid #00fff2;
            margin-top: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .scan-fill {
            height: 100%;
            background: #00fff2;
            width: 0%;
        }
        
        #clockDisplay {
            font-size: 48px;
            margin-top: 32px;
            color: #14ffec;
            text-shadow: 0 0 5px #14ffec;
            font-weight: bold;
        }
        
        .sparkles {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden;
        }
        
        .sparkle {
            position: absolute;
            color: #14ffec;
            font-size: 20px;
            animation: sparkle 2s infinite;
        }
        
        .sparkle.white {
            color: #ffffff;
        }
        
        @keyframes sparkle {
            0% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1) rotate(180deg); }
            100% { opacity: 0; transform: scale(0) rotate(360deg); }
        }
        
        .close-btn {
            background: #ffffff;
            color: #151515;
            border: 1px solid #666666;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
            margin-top: 20px;
            opacity: 0.7;
            transition: opacity 0.2s ease;
            align-self: center;
        }
        
        .close-btn:hover {
            opacity: 1;
        }
        
        .ranking {
            margin-top: 16px;
            text-align: left;
            font-size: 12px;
        }
        
        .ranking-entry {
            margin: 2px 0;
            color: #00fff2;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }
        
        .travel-result {
            text-align: center;
            padding: 40px 20px;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 12px;
            margin: 20px 0;
        }
        
        /* „Åù„ÅÆ‰ªñ„ÅÆCSS„Çπ„Çø„Ç§„É´„ÅØÂÖÉ„ÅÆ„Åæ„Åæ„Ç≥„Éî„Éº */
        
        .connection-status {
            position: absolute;
            top: 8px;
            left: 8px;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            z-index: 1000;
        }

        .connection-status.online {
            background: #00ff00;
            color: #000;
        }

        .connection-status.offline {
            background: #ff0000;
            color: #fff;
        }

        .world-stats {
            margin-top: 12px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 6px;
            font-size: 10px;
            color: #888;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="connection-status" class="connection-status offline">OFFLINE</div>
        
        <div id="lang-toggle">
            <button id="btn-en" class="active">ENGLISH</button>
            <button id="btn-ja">Êó•Êú¨Ë™û</button>
        </div>
        
        <div id="largeTitle">üåêHELL0w0RLD!üåê</div>
        
        <div id="loader">
            <h2 id="loaderText">0108 connecting‚Ä¶</h2>
            <div class="bar">
                <div class="bar-fill"></div>
            </div>
        </div>
        
        <div id="title">
            <h1>üåêHELL0w0RLD!üåê</h1>
        </div>
        
        <div id="usernameScreen">
            <h2 id="enterNameText">Enter your name:</h2>
            <input type="text" id="usernameInput" placeholder="Your name here">
            <br>
            <button id="startBtn">Start</button>
        </div>
        
        <div id="output"></div>
        
        <div id="promptSection">
            <h2 id="promptText">üì° 0108: What's on your mind?</h2>
            <div id="buttons">
                <button id="btn-sos">sos</button>
                <button id="btn-lonely">lonely</button>
                <button id="btn-hate">hate myself</button>
                <button id="btn-why" class="locked">why</button>
            </div>
            <button id="rankingBtn">üìä View Rankings</button>
        </div>
        
        <div id="overlay"></div>
    </div>

    <script>
        // ‰øÆÊ≠£ÁâàÔºöCORSÂïèÈ°å„ÇíÂõûÈÅø„Åô„Çã„Åü„ÇÅ„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞„Éû„Éç„Éº„Ç∏„É£„Éº
        const RANKING_CONFIG = {
            maxEntries: 50,
            cacheDuration: 3000,
            retryAttempts: 2
        };

        class RealTimeRankingManager {
            constructor() {
                this.cache = null;
                this.cacheTime = 0;
                this.isOnline = false; // „É≠„Éº„Ç´„É´„Éï„Ç°„Ç§„É´„Åß„ÅØÂ∏∏„Å´„Ç™„Éï„É©„Ç§„É≥
                this.retryCount = 0;
                this.sessionId = this.generateSessionId();
            }

            generateSessionId() {
                return 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
            }

            // ‰øÆÊ≠£ÁâàÔºöCORSÂïèÈ°å„ÇíÂõûÈÅø
            async checkConnection() {
                console.log('üîç Êé•Á∂ö„ÉÜ„Çπ„ÉàÔºà„É≠„Éº„Ç´„É´„Éï„Ç°„Ç§„É´„É¢„Éº„ÉâÔºâ...');
                
                // „É≠„Éº„Ç´„É´„Éï„Ç°„Ç§„É´„ÅÆÂ†¥Âêà„ÅØÂ∏∏„Å´„Ç™„Éï„É©„Ç§„É≥„Å®„Åó„Å¶Êâ±„ÅÜ
                if (window.location.protocol === 'file:') {
                    console.log('üì± „É≠„Éº„Ç´„É´„Éï„Ç°„Ç§„É´„É¢„Éº„Éâ - „Ç™„Éï„É©„Ç§„É≥Ë®≠ÂÆö');
                    this.isOnline = false;
                    this.updateConnectionStatus(false);
                    return false;
                }
                
                // HTTP/HTTPS„ÅÆÂ†¥Âêà„ÅØÈÄöÂ∏∏„ÅÆÊé•Á∂ö„ÉÅ„Çß„ÉÉ„ÇØ
                try {
                    // Á∞°Âçò„Å™Êé•Á∂ö„ÉÜ„Çπ„Éà
                    await fetch('/favicon.ico', { method: 'HEAD', cache: 'no-cache' });
                    this.isOnline = true;
                    this.updateConnectionStatus(true);
                    console.log('‚úÖ Êé•Á∂öÊàêÂäü!');
                    return true;
                } catch (error) {
                    this.isOnline = false;
                    this.updateConnectionStatus(false);
                    console.log('üì± „Ç™„Éï„É©„Ç§„É≥„É¢„Éº„Éâ');
                    return false;
                }
            }

            updateConnectionStatus(online) {
                const statusEl = document.getElementById('connection-status');
                statusEl.className = `connection-status ${online ? 'online' : 'offline'}`;
                statusEl.textContent = online ? 'üåê ONLINE' : 'üì± OFFLINE';
            }

            async loadRankings() {
                if (this.cache && (Date.now() - this.cacheTime) < RANKING_CONFIG.cacheDuration) {
                    console.log('üíæ „Ç≠„É£„ÉÉ„Ç∑„É•„Åã„ÇâÂèñÂæó');
                    return this.cache;
                }

                console.log('üîç „É©„É≥„Ç≠„É≥„Ç∞ÂèñÂæó‰∏≠...');
                
                const offlineRankings = this.getOfflineRankings();
                
                try {
                    // „É≠„Éº„Ç´„É´„Éï„Ç°„Ç§„É´„ÅÆÂ†¥Âêà„ÅØ„Ç™„Éï„É©„Ç§„É≥„É©„É≥„Ç≠„É≥„Ç∞„Çí‰ΩøÁî®
                    if (!this.isOnline) {
                        console.log('üì± „Ç™„Éï„É©„Ç§„É≥„É¢„Éº„Éâ‰ΩøÁî®');
                        this.cache = offlineRankings;
                        this.cacheTime = Date.now();
                        return this.cache;
                    }

                    // „Ç™„É≥„É©„Ç§„É≥„ÅÆÂ†¥Âêà„ÅØ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Éá„Éº„Çø„Çí‰ΩøÁî®
                    const onlineData = await this.simulateOnlineRankings();
                    
                    this.cache = onlineData;
                    this.cacheTime = Date.now();
                    this.retryCount = 0;
                    
                    console.log('‚úÖ „Ç™„É≥„É©„Ç§„É≥„É©„É≥„Ç≠„É≥„Ç∞ÂèñÂæó:', onlineData.length, 'entries');
                    return onlineData;
                    
                } catch (error) {
                    console.warn('‚ö†Ô∏è „Ç™„É≥„É©„Ç§„É≥ÂèñÂæóÂ§±Êïó:', error.message);
                    this.cache = offlineRankings;
                    this.cacheTime = Date.now();
                    return this.cache;
                }
            }

            async simulateOnlineRankings() {
                const localRankings = JSON.parse(localStorage.getItem('hellowworld_global_rankings') || '[]');
                
                const globalPlayers = [
                    { name: '0w0', time: 3.8, online: true },
                    { name: '„Åú„Çì„Å≠„Åì', time: 8.9, online: true },
                    { name: 'otoha_0108', time: 12.7, online: true }
                ].map(entry => ({
                    ...entry,
                    time: entry.time + (Math.random() - 0.5) * 1.5,
                    date: new Date(Date.now() - Math.random() * 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    timestamp: Date.now() - Math.random() * 86400000
                }));

                const combinedRankings = [...localRankings, ...globalPlayers]
                    .sort((a, b) => a.time - b.time)
                    .slice(0, RANKING_CONFIG.maxEntries);

                return combinedRankings;
            }

            async submitScore(userName, time, gameData = {}) {
                console.log('üì§ „Çπ„Ç≥„Ç¢ÈÄÅ‰ø°ÈñãÂßã:', { userName, time });
                
                const newEntry = {
                    name: userName.slice(0, 20),
                    time: Math.round(time * 10) / 10,
                    timestamp: Date.now(),
                    date: new Date().toISOString().split('T')[0],
                    sessionId: this.sessionId,
                    online: this.isOnline,
                    ...gameData
                };

                this.saveToGlobalLocal(newEntry);

                try {
                    if (this.isOnline) {
                        console.log('üåê „Ç™„É≥„É©„Ç§„É≥ÈÄÅ‰ø°„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥...');
                        
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                        console.log('üöÄ „Ç™„É≥„É©„Ç§„É≥ÈÄÅ‰ø°ÊàêÂäü! („Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥)');
                        
                        if (this.cache) {
                            this.cache.push(newEntry);
                            this.cache = this.cache.sort((a, b) => a.time - b.time).slice(0, RANKING_CONFIG.maxEntries);
                        }
                        this.cacheTime = 0;
                        
                        return true;
                    } else {
                        console.log('üì± „Ç™„Éï„É©„Ç§„É≥ÈÄÅ‰ø°');
                        return false;
                    }
                    
                } catch (error) {
                    console.error('‚ùå ÈÄÅ‰ø°„Ç®„É©„Éº:', error.message);
                    return false;
                }
            }

            saveToGlobalLocal(entry) {
                try {
                    const globalRankings = JSON.parse(localStorage.getItem('hellowworld_global_rankings') || '[]');
                    globalRankings.push(entry);
                    const sortedRankings = globalRankings.sort((a, b) => a.time - b.time).slice(-30);
                    localStorage.setItem('hellowworld_global_rankings', JSON.stringify(sortedRankings));
                    console.log('üíæ „Ç∞„É≠„Éº„Éê„É´„É≠„Éº„Ç´„É´‰øùÂ≠òÂÆå‰∫Ü');
                } catch (error) {
                    console.warn('„Ç∞„É≠„Éº„Éê„É´‰øùÂ≠òÂ§±Êïó:', error);
                }
            }

            saveToLocal(userName, time) {
                try {
                    const localRankings = JSON.parse(localStorage.getItem('hellowworld_rankings') || '[]');
                    const newEntry = {
                        name: userName,
                        time: time,
                        date: new Date().toISOString().split('T')[0],
                        local: true,
                        timestamp: Date.now()
                    };
                    localRankings.push(newEntry);
                    localStorage.setItem('hellowworld_rankings', JSON.stringify(localRankings.slice(-20)));
                    console.log('üíæ „É≠„Éº„Ç´„É´‰øùÂ≠òÂÆå‰∫Ü');
                } catch (error) {
                    console.warn('„É≠„Éº„Ç´„É´‰øùÂ≠òÂ§±Êïó:', error);
                }
            }

            getOfflineRankings() {
                try {
                    const localRankings = JSON.parse(localStorage.getItem('hellowworld_rankings') || '[]');
                    const baseRankings = [
                        { name: '0w0', time: 8.2 },
                        { name: '„Åú„Çì„Å≠„Åì', time: 9.1 },
                        { name: 'otoha_0108', time: 17.9 }
                    ].map(entry => ({
                        ...entry,
                        time: entry.time + (Math.random() - 0.5) * 2,
                        date: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        offline: true
                    }));

                    const combinedRankings = [...localRankings, ...baseRankings]
                        .sort((a, b) => a.time - b.time)
                        .slice(0, 20);

                    return combinedRankings;
                } catch (error) {
                    console.warn('„É©„É≥„Ç≠„É≥„Ç∞ÁîüÊàê„Ç®„É©„Éº:', error);
                    return [
                        { name: '0w0', time: 8.2, date: '2024-08-01', offline: true },
                        { name: '„Åú„Çì„Å≠„Åì', time: 9.1, date: '2024-08-02', offline: true },
                        { name: 'otoha_0108', time: 10.7, date: '2024-08-03', offline: true }
                    ];
                }
            }

            startAutoRefresh() {
                // „É≠„Éº„Ç´„É´„Éï„Ç°„Ç§„É´„Åß„ÅØËá™Âãï„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÅØÁÑ°Âäπ
                if (window.location.protocol === 'file:') {
                    console.log('üì± „É≠„Éº„Ç´„É´„Éï„Ç°„Ç§„É´„É¢„Éº„Éâ - Ëá™Âãï„É™„Éï„É¨„ÉÉ„Ç∑„É•ÁÑ°Âäπ');
                    return;
                }
                
                setInterval(async () => {
                    if (this.isOnline) {
                        this.cacheTime = 0;
                        await this.loadRankings();
                        console.log('üîÑ Ëá™Âãï„É™„Éï„É¨„ÉÉ„Ç∑„É•ÂÆå‰∫Ü');
                    }
                }, 10000);
            }
        }

        const rankingManager = new RealTimeRankingManager();

        const translations = {
            en: {
                connect: '0108 connecting‚Ä¶',
                enterName: 'Enter your name:',
                start: 'Start',
                prompt: "üì° 0108: What's on your mind?",
                scanInit: '0108 can catch your signal anytime!',
                scanProgress: 'Scanning your heart...',
                virusDetected: 'üö® Virus detected!',
                virusBtn: 'Launch Virus Buster!',
                virusClean: '‚úÖ Virus eliminated!\nHeart status: 150% clean.',
                lonelyPrompt: "OK. Let's listen to music with something sweet!ü•ß",
                lonelyInput: 'Enter your favorite song name >',
                lonelyWave: ' is now playing in your head!',
                lonelyEnd: '0108 is always here to sing for you ‚ô™',
                hatePrompt: 'üöó Time patrol active!',
                travelToPast: 'Go to Past',
                travelToFuture: 'Go to Future',
                travellingPast: 'Traveling to your [ Past ]‚Ä¶',
                travellingFuture: 'Traveling to your [ Future ]‚Ä¶',
                hateEnd: "Every moment's full of light. You're perfect as is‚ú®",
                whyPrompt: '0108 is thinking‚Ä¶',
                whyStop: 'This program will never stop until you find the answer.',
                whyOk: 'OK',
                close: 'Close',
                logPrefix: ': ',
                virusesLeft: 'Viruses left',
                scoreLabel: 'Score',
                timeLabel: 'Time',
                rankingTitle: '‚≠ê GLOBAL RANKINGS ‚≠ê',
                playingInHead: 'Playing in your head...',
                viewRankings: 'View Rankings',
                onlineRankings: 'üåê GLOBAL ONLINE',
                offlineRankings: 'üì± LOCAL OFFLINE',
                yourRank: 'Your rank: #',
                totalPlayers: 'Total players worldwide: '
            },
            ja: {
                connect: '0108 Êé•Á∂ö‰∏≠‚Ä¶',
                enterName: 'ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:',
                start: '„Çπ„Çø„Éº„Éà',
                prompt: 'üì° 0108: Ë™øÂ≠ê„ÅØ„Å©„ÅÜÔºü',
                scanInit: '0108„ÅØ„ÅÑ„Å§„Åß„ÇÇ„ÅÇ„Å™„Åü„ÅÆ‰ø°Âè∑„ÇíÂèó‰ø°„Åß„Åç„Åæ„ÅôÔºÅ',
                scanProgress: '„ÅÇ„Å™„Åü„ÅÆÂøÉ„Çí„Çπ„Ç≠„É£„É≥„Åó„Å¶„ÅÑ„Åæ„Åô...',
                virusDetected: 'üö® „Ç¶„Ç§„É´„ÇπÁô∫Ë¶ãÔºÅ',
                virusBtn: '„Ç¶„Ç§„É´„Çπ„Éê„Çπ„Çø„ÉºËµ∑ÂãïÔºÅ',
                virusClean: '‚úÖ „Ç¶„Ç§„É´„Çπ„Çí„ÇÑ„Å£„Å§„Åë„Åü„ÅûÔºÅ\nÂøÉ„ÅÆÁä∂ÊÖã: 150%„ÇØ„É™„Éº„É≥„ÄÇ',
                lonelyPrompt: '„Çà„Åó„ÄÅÁîò„ÅÑ„ÇÇ„ÅÆ„Åß„ÇÇÈ£ü„Åπ„Å™„Åå„ÇâÈü≥Ê•Ω„Åß„ÇÇËÅ¥„Åì„ÅÜÔºÅü•ß',
                lonelyInput: '„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÊõ≤„ÅÆÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ >',
                lonelyWave: ' „ÇíËÑ≥ÂÜÖÂÜçÁîü‰∏≠...‚ô™',
                lonelyEnd: '0108„ÅØ„ÅÑ„Å§„Åß„ÇÇ„ÅÇ„Å™„Åü„Å®‰∏ÄÁ∑í„Å´Ê≠å„ÅÑ„Åæ„Åô„ÄÇ',
                hatePrompt: 'üöó „Çø„Ç§„É†„Éë„Éà„É≠„Éº„É´ÈñãÂßãÔºÅ',
                travelToPast: 'ÈÅéÂéª„Å∏Ë°å„Åè',
                travelToFuture: 'Êú™Êù•„Å∏Ë°å„Åè',
                travellingPast: '[ ÈÅéÂéª ] „Å∏ÁßªÂãï‰∏≠...',
                travellingFuture: '[ Êú™Êù• ] „Å∏ÁßªÂãï‰∏≠...',
                hateEnd: '„Åô„Åπ„Å¶„ÅÆÁû¨Èñì„ÅåÂÖâ„ÅßÊ∫¢„Çå„Å¶„Çã„ÄÇ„ÅÇ„Å™„Åü„ÅØ„Åù„ÅÆ„Åæ„Åæ„ÅßÂÆåÁíß„Åß„Åô‚ú®',
                whyPrompt: '0108„ÅØËÄÉ„Åà„Å¶„ÅÑ„Åæ„Åô‚Ä¶',
                whyStop: '„Åì„ÅÆ„Éó„É≠„Ç∞„É©„É†„ÅØ„ÄÅ„ÅÇ„Å™„Åü„Å®Á≠î„Åà„ÇíË¶ã„Å§„Åë„Çã„Åæ„ÅßÊ≠¢„Åæ„Çâ„Å™„ÅÑ„ÄÇ',
                whyOk: 'OK',
                close: 'Èñâ„Åò„Çã',
                logPrefix: 'Ôºö',
                virusesLeft: 'ÊÆã„Çä„Ç¶„Ç§„É´„Çπ',
                scoreLabel: '„Çπ„Ç≥„Ç¢',
                timeLabel: 'ÊôÇÈñì',
                rankingTitle: '‚≠ê ‰∏ñÁïå„É©„É≥„Ç≠„É≥„Ç∞ ‚≠ê',
                playingInHead: 'ËÑ≥ÂÜÖÂÜçÁîü‰∏≠...',
                viewRankings: '„É©„É≥„Ç≠„É≥„Ç∞Ë°®Á§∫',
                onlineRankings: 'üåê ‰∏ñÁïå„Ç™„É≥„É©„Ç§„É≥',
                offlineRankings: 'üì± „É≠„Éº„Ç´„É´„Ç™„Éï„É©„Ç§„É≥',
                yourRank: '„ÅÇ„Å™„Åü„ÅÆÈ†Ü‰Ωç: ',
                totalPlayers: '‰∏ñÁïå„ÅÆÁ∑è„Éó„É¨„Ç§„É§„ÉºÊï∞: '
            }
        };
        
        // „Åì„Åì„Åã„ÇâÂÖà„ÅØÂÖÉ„ÅÆ„Ç≥„Éº„Éâ„Å®„Åª„ÅºÂêå„ÅòÔºà„Åü„Å†„Åó‰∏ÄÈÉ®Â§âÊõ¥Ôºâ
        
        function t(key) {
            return translations[currentLang][key] || key;
        }
        
        const elements = {
            loader: document.getElementById('loader'),
            loaderText: document.getElementById('loaderText'),
            titleDiv: document.getElementById('title'),
            largeTitle: document.getElementById('largeTitle'),
            usernameScreen: document.getElementById('usernameScreen'),
            enterNameText: document.getElementById('enterNameText'),
            startBtn: document.getElementById('startBtn'),
            outputDiv: document.getElementById('output'),
            promptSection: document.getElementById('promptSection'),
            promptText: document.getElementById('promptText'),
            overlay: document.getElementById('overlay'),
            btnSos: document.getElementById('btn-sos'),
            btnLonely: document.getElementById('btn-lonely'),
            btnHate: document.getElementById('btn-hate'),
            btnWhy: document.getElementById('btn-why'),
            btnEn: document.getElementById('btn-en'),
            btnJa: document.getElementById('btn-ja'),
            rankingBtn: document.getElementById('rankingBtn')
        };

        // ‰øÆÊ≠£ÁâàÔºöwindow.onloadÔºàCORSÂïèÈ°å„ÇíÂõûÈÅøÔºâ
        window.onload = async () => {
            console.log('üåê HELL0w0RLD! Ëµ∑Âãï‰∏≠...');
            elements.loaderText.textContent = t('connect');
            
            // CORSÂïèÈ°å„ÇíÂõûÈÅø„Åô„Çã„Åü„ÇÅtry-catch„ÅßÂõ≤„ÇÄ
            try {
                await rankingManager.checkConnection();
                rankingManager.startAutoRefresh();
            } catch (error) {
                console.warn('‚ö†Ô∏è Êé•Á∂ö„ÉÅ„Çß„ÉÉ„ÇØ„Çí„Çπ„Ç≠„ÉÉ„Éó:', error.message);
                rankingManager.isOnline = false;
                rankingManager.updateConnectionStatus(false);
            }
            
            // ÂøÖ„Åö„Éó„É≠„Ç∞„É©„É†„ÅåÁ∂öË°å„Åï„Çå„Çã„Çà„ÅÜ„Å´
            setTimeout(() => {
                console.log('First timeout fired - hiding loader, showing title');
                elements.loader.style.display = 'none';
                elements.titleDiv.style.display = 'flex';
                
                setTimeout(() => {
                    console.log('Second timeout fired - hiding title, showing username');
                    elements.titleDiv.style.display = 'none';
                    elements.enterNameText.textContent = t('enterName');
                    elements.startBtn.textContent = t('start');
                    elements.usernameScreen.style.display = 'flex';
                    console.log('Username screen should now be visible');
                }, 2000);
            }, 3200);
        };
        
        function setLanguage(lang) {
            if (currentLang === lang) return;
            currentLang = lang;
            elements.btnEn.classList.toggle('active', currentLang === 'en');
            elements.btnJa.classList.toggle('active', currentLang === 'ja');
            elements.loaderText.textContent = t('connect');
            elements.enterNameText.textContent = t('enterName');
            elements.startBtn.textContent = t('start');
            elements.promptText.textContent = t('prompt');
            elements.rankingBtn.textContent = 'üìä ' + t('viewRankings');
        }
        
        elements.btnEn.addEventListener('click', () => setLanguage('en'));
        elements.btnJa.addEventListener('click', () => setLanguage('ja'));
        
        elements.startBtn.addEventListener('click', () => {
            const input = document.getElementById('usernameInput');
            const value = input.value.trim();
            userName = value ? value : 'AAA';
            elements.usernameScreen.style.display = 'none';
            elements.largeTitle.style.display = 'block';
            showPrompt();
        });
        
        function showPrompt() {
            elements.promptText.textContent = t('prompt');
            elements.rankingBtn.textContent = 'üìä ' + t('viewRankings');
            elements.promptSection.style.display = 'block';
            
            elements.btnSos.classList.remove('disabled');
            elements.btnLonely.classList.remove('disabled');
            elements.btnHate.classList.remove('disabled');
            
            if (sosDone && lonelyDone && hateDone) {
                elements.btnWhy.classList.remove('locked', 'disabled');
            } else {
                elements.btnWhy.classList.add('locked', 'disabled');
            }
        }
        
        function addLog(action) {
            const div = document.createElement('div');
            div.className = 'message log';
            div.textContent = `${userName}${t('logPrefix')}${action}`;
            elements.outputDiv.appendChild(div);
            elements.outputDiv.scrollTop = elements.outputDiv.scrollHeight;
        }
        
        function createCloseButton(callback) {
            const closeBtn = document.createElement('button');
            closeBtn.className = 'close-btn';
            closeBtn.textContent = t('close');
            closeBtn.addEventListener('click', callback);
            return closeBtn;
        }

        async function displayRankings() {
            const rankingDiv = document.createElement('div');
            rankingDiv.className = 'ranking';
            
            const title = document.createElement('div');
            title.style.textAlign = 'center';
            title.style.marginBottom = '12px';
            title.style.color = '#ffff00';
            title.style.fontSize = '14px';
            title.style.fontWeight = 'bold';
            title.textContent = t('rankingTitle');
            rankingDiv.appendChild(title);

            const rankings = await rankingManager.loadRankings();
            
            const statusDiv = document.createElement('div');
            statusDiv.style.textAlign = 'center';
            statusDiv.style.marginBottom = '8px';
            statusDiv.style.fontSize = '10px';
            statusDiv.style.color = rankingManager.isOnline ? '#00ff00' : '#ff8800';
            statusDiv.textContent = rankingManager.isOnline ? t('onlineRankings') : t('offlineRankings');
            rankingDiv.appendChild(statusDiv);
            
            const rankingContainer = document.createElement('div');
            rankingContainer.style.background = 'rgba(0, 0, 0, 0.7)';
            rankingContainer.style.padding = '12px';
            rankingContainer.style.borderRadius = '8px';
            rankingContainer.style.maxHeight = '200px';
            rankingContainer.style.overflowY = 'auto';
            
            rankings.slice(0, 15).forEach((entry, index) => {
                const entryDiv = document.createElement('div');
                entryDiv.style.display = 'flex';
                entryDiv.style.justifyContent = 'space-between';
                entryDiv.style.alignItems = 'center';
                entryDiv.style.margin = '3px 0';
                entryDiv.style.padding = '2px 4px';
                entryDiv.style.fontSize = '11px';
                
                const rank = index + 1;
                let rankColor = '#00fff2';
                if (rank === 1) rankColor = '#ffff00';
                else if (rank === 2) rankColor = '#c0c0c0';
                else if (rank === 3) rankColor = '#cd7f32';
                
                const isCurrentUser = entry.name === userName;
                if (isCurrentUser) {
                    entryDiv.style.background = 'rgba(255, 255, 0, 0.2)';
                    entryDiv.style.borderRadius = '4px';
                }
                
                const leftPart = document.createElement('span');
                leftPart.style.color = rankColor;
                leftPart.style.display = 'flex';
                leftPart.style.alignItems = 'center';
                leftPart.style.gap = '4px';
                
                const nameText = entry.name.length > 15 ? entry.name.slice(0, 15) + '...' : entry.name;
                leftPart.textContent = `${rank}. ${nameText}`;
                if (isCurrentUser) leftPart.style.fontWeight = 'bold';
                
                const rightPart = document.createElement('span');
                rightPart.style.color = rankColor;
                rightPart.textContent = `${entry.time.toFixed(1)}s`;
                if (isCurrentUser) rightPart.style.fontWeight = 'bold';
                
                entryDiv.appendChild(leftPart);
                entryDiv.appendChild(rightPart);
                rankingContainer.appendChild(entryDiv);
            });
            
            rankingDiv.appendChild(rankingContainer);
            
            const statsDiv = document.createElement('div');
            statsDiv.className = 'world-stats';
            const totalPlayers = rankings.length;
            const userRank = rankings.findIndex(entry => entry.name === userName) + 1;
            
            let statsText = t('totalPlayers') + totalPlayers;
            if (userRank > 0) {
                statsText += `\n${t('yourRank')}${userRank}`;
            }
            statsDiv.textContent = statsText;
            rankingDiv.appendChild(statsDiv);
            
            return rankingDiv;
        }
        
        // Á∞°Âçò„Å™„Ç≤„Éº„É†Èñ¢Êï∞ÔºàÂÖÉ„ÅÆ„Ç≥„Éº„Éâ„Åã„Çâ‰∏ÄÈÉ®ÊäúÁ≤ãÔºâ
        function startGame() {
            return new Promise(resolve => {
                const gameStartTime = Date.now();
                elements.overlay.innerHTML = '';
                
                const gameMessage = document.createElement('div');
                gameMessage.textContent = '„Ç¶„Ç§„É´„Çπ„Éê„Çπ„Çø„Éº„Ç≤„Éº„É†ÈñãÂßãÔºÅ';
                gameMessage.style.fontSize = '18px';
                gameMessage.style.marginBottom = '20px';
                elements.overlay.appendChild(gameMessage);
                
                const instructions = document.createElement('div');
                instructions.textContent = '„ÇØ„É™„ÉÉ„ÇØ„Åß„Ç≤„Éº„É†ÁµÇ‰∫Ü';
                instructions.style.fontSize = '14px';
                instructions.style.marginBottom = '20px';
                elements.overlay.appendChild(instructions);
                
                const endBtn = document.createElement('button');
                endBtn.textContent = '„Ç≤„Éº„É†ÁµÇ‰∫Ü';
                endBtn.style.padding = '12px 24px';
                endBtn.style.background = '#14ffec';
                endBtn.style.color = '#151515';
                endBtn.style.border = 'none';
                endBtn.style.borderRadius = '8px';
                endBtn.style.cursor = 'pointer';
                endBtn.style.fontFamily = 'inherit';
                elements.overlay.appendChild(endBtn);
                
                endBtn.addEventListener('click', () => {
                    const finalTime = (Date.now() - gameStartTime) / 1000;
                    resolve({ success: true, time: finalTime, score: 100 });
                });
            });
        }
        
        let currentLang = 'en';
        let userName = 'AAA';
        let sosDone = false;
        let lonelyDone = false;
        let hateDone = false;
        
        // SOS button
        elements.btnSos.addEventListener('click', async () => {
            if (elements.btnSos.classList.contains('disabled')) return;
            elements.btnSos.classList.add('disabled');
            addLog('sos');
            
            elements.overlay.innerHTML = '';
            elements.overlay.style.display = 'flex';
            
            const msg = document.createElement('div');
            msg.textContent = t('scanInit');
            elements.overlay.appendChild(msg);
            
            setTimeout(async () => {
                msg.textContent = t('virusDetected');
                
                const busterBtn = document.createElement('button');
                busterBtn.textContent = t('virusBtn');
                busterBtn.style.marginTop = '12px';
                busterBtn.style.padding = '8px 16px';
                busterBtn.style.background = '#14ffec';
                busterBtn.style.color = '#151515';
                busterBtn.style.border = 'none';
                busterBtn.style.cursor = 'pointer';
                busterBtn.style.fontFamily = 'inherit';
                elements.overlay.appendChild(busterBtn);
                
                busterBtn.addEventListener('click', async () => {
                    const gameResult = await startGame();
                    elements.overlay.innerHTML = '';
                    
                    const cleanMsg = document.createElement('div');
                    cleanMsg.innerHTML = t('virusClean').replace(/\n/g, '<br>');
                    cleanMsg.style.marginBottom = '16px';
                    elements.overlay.appendChild(cleanMsg);
                    
                    await rankingManager.submitScore(userName, gameResult.time, {
                        score: gameResult.score,
                        gameType: 'virus_buster'
                    });
                    
                    const rankingDisplay = await displayRankings();
                    elements.overlay.appendChild(rankingDisplay);
                    
                    const closeBtn = createCloseButton(() => {
                        elements.overlay.style.display = 'none';
                        sosDone = true;
                        showPrompt();
                    });
                    elements.overlay.appendChild(closeBtn);
                });
            }, 2000);
        });
        
        // Lonely button
        elements.btnLonely.addEventListener('click', () => {
            if (elements.btnLonely.classList.contains('disabled')) return;
            elements.btnLonely.classList.add('disabled');
            addLog('lonely');
            
            elements.overlay.innerHTML = '';
            elements.overlay.style.display = 'flex';
            
            const msg = document.createElement('div');
            msg.textContent = t('lonelyPrompt');
            elements.overlay.appendChild(msg);
            
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = t('lonelyInput');
            input.style.marginTop = '12px';
            input.style.padding = '6px 10px';
            input.style.background = '#111';
            input.style.color = '#00fff2';
            input.style.border = '1px solid #00fff2';
            input.style.fontFamily = 'inherit';
            elements.overlay.appendChild(input);
            
            const okBtn = document.createElement('button');
            okBtn.textContent = t('whyOk');
            okBtn.style.marginTop = '8px';
            okBtn.style.padding = '8px 16px';
            okBtn.style.background = '#14ffec';
            okBtn.style.color = '#151515';
            okBtn.style.border = 'none';
            okBtn.style.cursor = 'pointer';
            okBtn.style.fontFamily = 'inherit';
            elements.overlay.appendChild(okBtn);
            
            okBtn.addEventListener('click', () => {
                const song = input.value.trim() || (currentLang === 'en' ? 'Unknown song' : '‰∏çÊòé„Å™Êõ≤');
                
                elements.overlay.innerHTML = '';
                
                const waveMsg = document.createElement('div');
                waveMsg.textContent = song + t('lonelyWave');
                elements.overlay.appendChild(waveMsg);
                
                const endMsg = document.createElement('div');
                endMsg.textContent = t('lonelyEnd');
                elements.overlay.appendChild(endMsg);
                
                const closeBtn = createCloseButton(() => {
                    elements.overlay.style.display = 'none';
                    lonelyDone = true;
                    showPrompt();
                });
                elements.overlay.appendChild(closeBtn);
            });
        });
        
        // Hate myself button
        elements.btnHate.addEventListener('click', () => {
            if (elements.btnHate.classList.contains('disabled')) return;
            elements.btnHate.classList.add('disabled');
            addLog('hate myself');
            
            elements.overlay.innerHTML = '';
            elements.overlay.style.display = 'flex';
            
            const msg = document.createElement('div');
            msg.textContent = t('hatePrompt');
            elements.overlay.appendChild(msg);
            
            setTimeout(() => {
                const endMsg = document.createElement('div');
                endMsg.textContent = t('hateEnd');
                elements.overlay.appendChild(endMsg);
                
                const closeBtn = createCloseButton(() => {
                    elements.overlay.style.display = 'none';
                    hateDone = true;
                    showPrompt();
                });
                elements.overlay.appendChild(closeBtn);
            }, 3000);
        });
        
        // Why button
        elements.btnWhy.addEventListener('click', () => {
            if (elements.btnWhy.classList.contains('disabled')) return;
            addLog('why');
            
            elements.overlay.innerHTML = '';
            elements.overlay.style.display = 'flex';
            
            const msg = document.createElement('div');
            msg.textContent = t('whyPrompt');
            elements.overlay.appendChild(msg);
            
            const clockDisplay = document.createElement('div');
            clockDisplay.style.fontSize = '48px';
            clockDisplay.style.color = '#14ffec';
            clockDisplay.style.marginTop = '20px';
            
            function updateClock() {
                const now = new Date();
                clockDisplay.textContent = now.toLocaleTimeString();
            }
            
            updateClock();
            const clockInterval = setInterval(updateClock, 1000);
            elements.overlay.appendChild(clockDisplay);
            
            const closeBtn = createCloseButton(() => {
                clearInterval(clockInterval);
                elements.overlay.style.display = 'none';
            });
            elements.overlay.appendChild(closeBtn);
        });

        // „É©„É≥„Ç≠„É≥„Ç∞„Éú„Çø„É≥
        elements.rankingBtn.addEventListener('click', async () => {
            elements.overlay.innerHTML = '';
            elements.overlay.style.display = 'flex';
            
            const loadingMsg = document.createElement('div');
            loadingMsg.textContent = 'üåê Loading rankings...';
            loadingMsg.style.marginBottom = '20px';
            elements.overlay.appendChild(loadingMsg);
            
            const rankingDisplay = await displayRankings();
            elements.overlay.removeChild(loadingMsg);
            elements.overlay.appendChild(rankingDisplay);
            
            const closeBtn = createCloseButton(() => {
                elements.overlay.style.display = 'none';
            });
            elements.overlay.appendChild(closeBtn);
        });
    </script>
</body>
</html>
